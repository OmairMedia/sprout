TYPE=TRIGGERS
triggers='CREATE DEFINER=`root`@`localhost` TRIGGER `audit_users_add` BEFORE INSERT ON `user` FOR EACH ROW BEGIN\n	DECLARE schema_name varchar(500);\n	DECLARE company_name_copy varchar(150);\n	DECLARE company_image_url varchar(250);\n\n	SELECT DATABASE() INTO schema_name FROM DUAL;\n	select company_name, image_url into company_name_copy,company_image_url from users_company where type=\'base\';\n	IF NEW.email not in (\n            select email\n            From sprout_users.users\n            where email = NEW.email\n        ) \n	THEN \n		BEGIN\n    		INSERT INTO sprout_users.users (id,name,email,password) values (\'\',NEW.username,NEW.email,NEW.password);\n			INSERT INTO sprout_users.users_companies(database_name,user_id,status,company_image_url,company_name,role) values (schema_name,LAST_INSERT_ID(),NEW.status,company_image_url,company_name_copy,NEW.type);\n  		END;\n	ELSE\n		BEGIN\n			INSERT INTO sprout_users.users_companies(database_name,user_id,status,company_image_url,company_name,role) values (schema_name,(select id From sprout_users.users where email = NEW.email),NEW.status,company_image_url,company_name_copy,NEW.type);\n		END;\n	END IF;\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `audit_users_delete` BEFORE DELETE ON `user` FOR EACH ROW BEGIN\n	declare id_temp integer;\n	declare schema_name varchar(500);\n	\n	select id into id_temp from sprout_users.users where email = OLD.email;\n	SELECT DATABASE() INTO schema_name FROM DUAL;\n	\n	DELETE FROM sprout_users.users_companies\n	WHERE database_name = schema_name\n	AND user_id = id_temp;\n\nEND' 'CREATE DEFINER=`root`@`localhost` TRIGGER `audit_users_update` BEFORE UPDATE ON `user` FOR EACH ROW BEGIN\n	declare id_temp integer;\n	declare schema_name varchar(500);\n	\n	select id into id_temp from sprout_users.users where email = OLD.email;\n	SELECT DATABASE() INTO schema_name FROM DUAL;\n	\n	UPDATE sprout_users.users\n	SET \n	name = NEW.username,\n	email = NEW.email,\n	password = NEW.password\n	WHERE id = id_temp;\n	\n	UPDATE sprout_users.users_companies\n	SET \n	status = NEW.status,\n	role = NEW.type\n	WHERE database_name = schema_name\n	AND\n	user_id = id_temp;\n\nEND'
sql_modes=524288 524288 524288
definers='root@localhost' 'root@localhost' 'root@localhost'
client_cs_names='utf8mb4' 'utf8mb4' 'utf8mb4'
connection_cl_names='utf8mb4_general_ci' 'utf8mb4_general_ci' 'utf8mb4_general_ci'
db_cl_names='latin1_swedish_ci' 'latin1_swedish_ci' 'latin1_swedish_ci'
